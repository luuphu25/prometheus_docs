
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="vi">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Method monitoring &#8212; Tài liệu prometheus_docs 1</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Tìm Kiếm" href="../search.html" />
    <link rel="next" title="Metrics" href="Metric.html" />
    <link rel="prev" title="Welcome to prometheus_docs&#39;s documentation!" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="method-monitoring">
<h1>Method monitoring<a class="headerlink" href="#method-monitoring" title="Permalink to this headline">¶</a></h1>
<p>Nhiều service có thể bị ảnh hưởng hiệu suất do nền tảng OS mà nó chạy phía trên (linux). Đặc biệt việc monitor tài nguyên hệ thống của Linux càng cần thiết nếu ứng dụng nhạy cảm với tài nguyên hệ thống ( như I/O cần thiết cho DB service)</p>
<p>Đối với Linux, ta cần quan tâm nhất là CPU, Disk, một phần memory (cho saturation) và network . Thực chất Network hiện nay khá khó overload ( tầng OS) nên phần lớn vẫn dựa vào monitor ở service ( lantency, rate) …</p>
<p>Tuy nhiên cũng có thể monitor rate của IN/OUT network để cung cấp khả năng phát hiện các hoạt động bất thường đối với hệ thống với việc phổi hợp các metrics khác.</p>
<p><strong>## CPU</strong></p>
<p>Khía cạnh thực tế cần quan tâm là Saturation và Utilization.</p>
<p>Saturation:  Để dễ dàng người ta thường đánh giá Load_avg(the number of processes using CPU or waiting for system resources (usually CPU and disk) .Tuy nhiên trong Linux Load Avg là gộp chung cả CPU và Disk I/O nên có thể làm khó phân biệt cụ thể.  Nếu service của hệ thông không hoạt động I/O nhiều thì chỉ số Load Avg có thể dùng đánh giá CPU saturation. Nhìn chung metric này vẫn cho ta nhận định được hệ thống có vấn đề không =&gt; xem xét các metrics cụ thể hơn của CPU và Disk</p>
<p>Ta có thể xem xét các</p>
<p>Đối với các server hypervisor ta có thể quan tâm thêm %Steal time., steal time nếu cao cũng chỉ ra CPU đang bị đầy.  Nếu %steam &gt; 20 % thì cần nên xem xét hoạt động của server <a class="footnote-reference" href="#id2" id="id1">[1]</a></p>
<p>[Percona] <a class="reference external" href="https://www.percona.com/blog/2017/08/04/saturation-metrics-in-pmm-120/">https://www.percona.com/blog/2017/08/04/saturation-metrics-in-pmm-120/</a></p>
<p><a class="reference external" href="https://pmmdemo.percona.com/graph/d/qyzrQGHmk/system-overview?refresh=1m&amp;panelId=33&amp;fullscreen&amp;orgId=1&amp;var-interval=$__auto_interval&amp;var-host=ps56&amp;from=now-12h&amp;to=now">https://pmmdemo.percona.com/graph/d/qyzrQGHmk/system-overview?refresh=1m&amp;panelId=33&amp;fullscreen&amp;orgId=1&amp;var-interval=$__auto_interval&amp;var-host=ps56&amp;from=now-12h&amp;to=now</a></p>
<p>Nên chú ý metrics CPU saturation sẽ không có nhiều ý nghĩ nếu hệ thống chạy service single-thread Nodejs server, Nginx … khi đó cần đánh giá CPU Utilization</p>
<p>#Utilization (% time mà tài nguyên đang hoạt động - the average time that the resource was busy servicing work</p>
<p>Ta tính tổng %</p>
<p>sum CPU %: User + Nice + System + (probably) Steal</p>
<p>Cần lưu ý tới I/O wait nếu chỉ số I/O wait cao là dấu hiệu hệ thống disk có bottleneck và làm chậm hệ thống</p>
<p>Softirq cao có thể là dấu hiệu có vấn đề ở thiết bị mạng</p>
<p>Nếu chỉ số idle = 0 trong 1 khoảng thời gian =&gt; khả năng xử lý của CPU tới giới hạn</p>
<p><a class="reference external" href="https://singapore.my-netdata.io/default.html#menu_system_submenu_cpu;theme=slate;help=true">https://singapore.my-netdata.io/default.html#menu_system_submenu_cpu;theme=slate;help=true</a></p>
<p>## Memory:</p>
<p>Đối vơi memory ta cũng chỉ quan tâm tới Saturation và Utilization</p>
<p>Saturation : Bất ki việc swap nào đều thể hiện việc thiếu RAM.  Tuy nhiên trên các OS linux khi chỉ số swappiness được set !=1 , thì có thể có tình trạng swap trước khi Ram được sử dụng hết điều này là do kernel ko giảm các cache khi thực hiện swap nên bộ nhớ của bạn có thể cạn kiệt trước khi toàn bộ RAM đều đầy bởi hoạt động của các tiến trình.</p>
<p>Cũng nên theo dõi OOM error (OUT of Memory) : khi RAM bị đầy nghiêm trọng, OS sẽ tự động kill process user chiếm nhiều RAM và đó có thể là service MySQL, server ..</p>
<p>Utilization: Tính toán % lượng Ram có thể sử dụng (free + buffer + cache)</p>
<p>Paging and Swaping: ( IBM read books )</p>
<p>Paging : di chuyển các page độc lập qua swap space trên disk ( page là đơn vị tổ chức địa chỉ nhớ trên Linux).</p>
<p>Swap: di chuyển cả vùng nhớ của tiến trình qua vùng swap.</p>
<p>Nếu system luôn thực hiện paging qua disk ( chỉ số paging out cao) =&gt; cần thêm ram cho server. Còn nếu rate của page_out thấp thì ko ảnh hưởng tới hiệu suất của hệ thống</p>
<p>A page fault is a type of interrupt, called trap, raised by computer hardware when a running program accesses a memory page that is mapped into the virtual address space, but not actually loaded into main memory. If the page is loaded in memory at the time the fault is generated, but is not marked in the memory management unit as being loaded in memory, then it is called a minor or soft page fault. A major page fault is generated when the system needs to load the memory page from disk or swap memory.</p>
<p>---</p>
<p>## Disk :</p>
<p>Request Rate : chỉ số IOPS của disk system ( r/s và w/s)</p>
<p>Error Rate: Không có lỗi cụ thể trên hệ thống đĩa ngoại trừ độ trễ quá cao. Hầu hết lỗi có thẻ xảy ra liên quan tới kiểu file hệ thống: ext4 hay nfs đều khó phát hiện và thường tìm thông qua kernel log.</p>
<p>Latency: Cần theo dõi cả read và write time.và chỉ số trễ thường tăng cao nếu disk bị bão hòa.</p>
<p>Utilization: nghĩa là đĩa đang thực hiện công việc nào đó. Thường thì 100% chỉ ra tình trạng đĩa có thể bị tắc nghẽn.</p>
<p>Saturation: sử dụng %util, ko quá chính xác nhưng đó đủ cho 1 hệ thông monitor đơn giản</p>
<p>Disk system là thành phần trọng yếu trong việc monitor server do nó có thể ảnh hưởng lớn tới khả năng hoạt động của service. Đồng thời cũng là nơi thường gặp vấn đề nhất. Tuy nhiên cũng có những vấn đề bị che dấu gián tiếp bởi các thành phần khác. ( IBM red book)  như thiết RAM, CPU sử dụng cao bởi các tiến trình đang đợi I/O</p>
<p>Disk chậm có thể là kết quả của:</p>
<p>Memory buffer bị đầy bởi dữ liệu cần ghi =&gt; Delay request vì không còn free mem để thực hiện write request hoặc response phải đợi dữ liệu được đọc từ disk</p>
<p>Thiếu Ram, không đủ buffer cho network request -&gt; lỗi ghi đồng bộ</p>
<p>Disk utilization, controller utilization</p>
<p>Disk chưa hoàn thành ( châm) -được thể hiện bở response time cao hay network utilization thấp</p>
<p>Disk I/O thời gian dài -&gt; hàng đợi full -&gt; CPU high idle + low utilization do đợi requests tiếp theo.</p>
<p>## Network:</p>
<p>Rate: READ/WRITE bandwidth / s</p>
<p>Utilization:  Read/write bandwith / total bandwitdth</p>
<blockquote>
<div><table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://scoutapp.com/blog/understanding-cpu-steal-time-when-should-you-be-worried">https://scoutapp.com/blog/understanding-cpu-steal-time-when-should-you-be-worried</a></td></tr>
</tbody>
</table>
</div></blockquote>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">prometheus_docs</a></h1>








<h3>Điều hướng</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Method monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metric.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Common_issues.html">Common problem</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="chương trước ">Welcome to prometheus_docs's documentation!</a></li>
      <li>Next: <a href="Metric.html" title="chương tiếp">Metrics</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Thực hiện" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, phuld2.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/post/Monitor_method.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>